<div class="topic-details-container">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>{{ 'COMMON.LOADING' | translate }}</p>
    </div>
  } @else if (error()) {
    <div class="error-container">
      <mat-icon>error</mat-icon>
      <p>{{ error() }}</p>
    </div>
  } @else if (topic()) {
    <nav class="breadcrumbs" *ngIf="subject()">
      <a [routerLink]="['/app/subjects', subjectId, 'card']">{{ subject()!.nameRu }}</a>
      <span class="separator">/</span>
      <span class="current">{{ topic()!.name }}</span>
    </nav>

    <mat-card class="topic-info-card">
      <mat-card-content>
        <div class="topic-header">
          <h2>{{ 'SUBJECT.TOPICS.TITLE_SINGULAR' | translate }} - {{ topic()!.name }}</h2>
          @if (topic()!.createdByFullName) {
            <span class="author">{{ topic()!.createdByFullName }}</span>
          }
        </div>
        @if (topic()!.description) {
          <p class="description">{{ topic()!.description }}</p>
        }
      </mat-card-content>
    </mat-card>

    <mat-card class="questions-card">
      <mat-card-content>
        <div class="questions-header">
          <h3>{{ 'TOPIC.DETAILS.QUESTIONS_TITLE' | translate }}</h3>
          <button mat-raised-button class="aqyldy-btn-mint" (click)="openCreateQuestion()">
            <mat-icon>add</mat-icon>
            {{ 'TOPIC.DETAILS.ADD_QUESTION' | translate }}
          </button>
        </div>

        @if (questionsLoading()) {
          <div class="loading-state">{{ 'COMMON.LOADING' | translate }}</div>
        } @else if (dataSource.data.length === 0) {
          <div class="empty-state">{{ 'TOPIC.DETAILS.NO_QUESTIONS' | translate }}</div>
        } @else {
          <table mat-table [dataSource]="dataSource" class="questions-table">
            <ng-container matColumnDef="question">
              <th mat-header-cell *matHeaderCellDef>{{ 'TOPIC.DETAILS.QUESTION' | translate }}</th>
              <td mat-cell *matCellDef="let row">
                <a class="question-link" (click)="viewQuestion(row)" [matTooltip]="'TOPIC.DETAILS.VIEW_ANSWERS' | translate">
                  {{ row.text }}
                </a>
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>{{ 'COMMON.ACTIONS' | translate }}</th>
              <td mat-cell *matCellDef="let row">
                <button
                  mat-icon-button
                  color="primary"
                  (click)="openEditQuestion(row)"
                  [matTooltip]="'COMMON.EDIT' | translate">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  (click)="deleteQuestion(row)"
                  [matTooltip]="'COMMON.DELETE' | translate">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="question-row"></tr>
          </table>

          <mat-paginator
            [length]="totalElements()"
            [pageSize]="pageSize"
            [pageIndex]="pageIndex"
            [pageSizeOptions]="[5, 10, 20, 50]"
            (page)="onPageChange($event)"
            showFirstLastButtons>
          </mat-paginator>
        }
      </mat-card-content>
    </mat-card>
  }
</div>
